<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema de asistencia para equipos de basketball integrado con Google Sheets">
    <meta name="theme-color" content="#ea580c">
    <title>üèÄ Basketball Attendance</title>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- jsQR para escaneo QR -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        * {
            box-sizing: border-box;
        }
        
        /* Animaciones suaves */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Estilos para el esc√°ner */
        #qr-video {
            max-width: 100%;
            border-radius: 12px;
        }
        
        /* PWA */
        @media (display-mode: standalone) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { Camera, Users, QrCode, ClipboardList, Plus, Check, Trash2, Download, BarChart3, RefreshCw, Wifi, WifiOff } = lucide;

        const BasketballAttendance = () => {
          const [view, setView] = useState('menu');
          const [players, setPlayers] = useState([]);
          const [sessions, setSessions] = useState([]);
          const [currentSession, setCurrentSession] = useState(null);
          const [newPlayer, setNewPlayer] = useState({ name: '', number: '', team: '' });
          const [scanning, setScanning] = useState(false);
          const [connected, setConnected] = useState(false);
          const [loading, setLoading] = useState(false);
          const [config, setConfig] = useState({
            sheetId: '',
            apiKey: ''
          });
          const [showConfig, setShowConfig] = useState(false);
          
          const videoRef = useRef(null);
          const streamRef = useRef(null);
          const canvasRef = useRef(null);
          const scanIntervalRef = useRef(null);

          // Cargar configuraci√≥n al inicio
          useEffect(() => {
            loadConfig();
          }, []);

          const loadConfig = () => {
            const saved = localStorage.getItem('bb_config');
            if (saved) {
              const parsed = JSON.parse(saved);
              setConfig(parsed);
              if (parsed.sheetId && parsed.apiKey) {
                loadFromSheets(parsed);
              }
            } else {
              setShowConfig(true);
            }
          };

          const saveConfig = () => {
            if (!config.sheetId || !config.apiKey) {
              alert('‚ùå Debes completar Sheet ID y API Key');
              return;
            }
            localStorage.setItem('bb_config', JSON.stringify(config));
            loadFromSheets(config);
            setShowConfig(false);
          };

          // Cargar datos desde Google Sheets
          const loadFromSheets = async (cfg = config) => {
            if (!cfg.sheetId || !cfg.apiKey) return;
            
            setLoading(true);
            try {
              // Cargar jugadores
              const playersUrl = `https://sheets.googleapis.com/v4/spreadsheets/${cfg.sheetId}/values/Jugadores!A2:D?key=${cfg.apiKey}`;
              const playersRes = await fetch(playersUrl);
              const playersData = await playersRes.json();
              
              if (playersData.values) {
                const loadedPlayers = playersData.values.map(row => ({
                  id: row[0] || Date.now().toString(),
                  name: row[1] || '',
                  number: row[2] || '',
                  team: row[3] || ''
                }));
                setPlayers(loadedPlayers);
              }

              // Cargar sesiones
              const sessionsUrl = `https://sheets.googleapis.com/v4/spreadsheets/${cfg.sheetId}/values/Sesiones!A2:C?key=${cfg.apiKey}`;
              const sessionsRes = await fetch(sessionsUrl);
              const sessionsData = await sessionsRes.json();
              
              if (sessionsData.values) {
                const loadedSessions = sessionsData.values.map(row => ({
                  id: row[0] || Date.now().toString(),
                  date: row[1] || new Date().toISOString(),
                  attendance: row[2] ? row[2].split(',') : []
                }));
                setSessions(loadedSessions);
              }

              setConnected(true);
              alert('‚úì Datos cargados desde Google Sheets');
            } catch (error) {
              console.error('Error cargando datos:', error);
              alert('‚ùå Error conectando con Google Sheets. Verifica tu configuraci√≥n.');
              setConnected(false);
            }
            setLoading(false);
          };

          // Guardar jugador en Google Sheets
          const savePlayerToSheet = async (player) => {
            try {
              const url = `https://sheets.googleapis.com/v4/spreadsheets/${config.sheetId}/values/Jugadores!A:D:append?valueInputOption=RAW&key=${config.apiKey}`;
              
              await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  values: [[player.id, player.name, player.number, player.team]]
                })
              });
              
              return true;
            } catch (error) {
              console.error('Error guardando jugador:', error);
              return false;
            }
          };

          // Guardar sesi√≥n en Google Sheets
          const saveSessionToSheet = async (session) => {
            try {
              const url = `https://sheets.googleapis.com/v4/spreadsheets/${config.sheetId}/values/Sesiones!A:C:append?valueInputOption=RAW&key=${config.apiKey}`;
              
              await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  values: [[session.id, session.date, session.attendance.join(',')]]
                })
              });
              
              return true;
            } catch (error) {
              console.error('Error guardando sesi√≥n:', error);
              return false;
            }
          };

          const addPlayer = async () => {
            if (!newPlayer.name || !newPlayer.number) {
              alert('‚ùå Completa nombre y n√∫mero');
              return;
            }

            if (players.find(p => p.number === newPlayer.number)) {
              alert('‚ùå Ya existe un jugador con ese n√∫mero');
              return;
            }

            const player = {
              id: Date.now().toString(),
              ...newPlayer
            };

            if (connected) {
              const saved = await savePlayerToSheet(player);
              if (!saved) {
                alert('‚ùå Error guardando en Google Sheets');
                return;
              }
            }

            setPlayers([...players, player]);
            setNewPlayer({ name: '', number: '', team: '' });
            alert('‚úì Jugador agregado');
          };

          const startSession = () => {
            if (players.length === 0) {
              alert('‚ùå Primero agrega jugadores');
              setView('players');
              return;
            }

            const session = {
              id: Date.now().toString(),
              date: new Date().toISOString(),
              attendance: []
            };
            setCurrentSession(session);
            setView('scanner');
          };

          const markAttendance = (playerId) => {
            if (!currentSession) return;
            
            const player = players.find(p => p.id === playerId);
            if (!player) {
              alert('‚ùå Jugador no encontrado');
              return;
            }

            if (currentSession.attendance.includes(playerId)) {
              alert(`${player.name} ya est√° registrado`);
              return;
            }

            const updated = {
              ...currentSession,
              attendance: [...currentSession.attendance, playerId]
            };
            setCurrentSession(updated);
            
            if (navigator.vibrate) {
              navigator.vibrate(100);
            }
            
            alert(`‚úì ${player.name} (#${player.number})`);
          };

          const endSession = async () => {
            if (!currentSession || currentSession.attendance.length === 0) {
              alert('‚ùå No hay asistencias registradas');
              return;
            }
            
            if (connected) {
              const saved = await saveSessionToSheet(currentSession);
              if (!saved) {
                alert('‚ö†Ô∏è Error guardando en Google Sheets, pero se guard√≥ localmente');
              }
            }

            setSessions([...sessions, currentSession]);
            setCurrentSession(null);
            stopCamera();
            setView('menu');
            alert(`‚úì Sesi√≥n guardada: ${currentSession.attendance.length} presentes`);
          };

          const manualEntry = () => {
            const number = prompt('N√∫mero del jugador:');
            if (!number) return;
            
            const player = players.find(p => p.number === number.trim());
            if (player) {
              markAttendance(player.id);
            } else {
              alert(`‚ùå Jugador #${number} no encontrado`);
            }
          };

          const generateQR = (playerId) => {
            return `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=BB_${playerId}`;
          };

          const startCamera = async () => {
            try {
              const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: 'environment', width: 640, height: 480 } 
              });
              
              if (videoRef.current) {
                videoRef.current.srcObject = stream;
                streamRef.current = stream;
                setScanning(true);
                
                // Iniciar escaneo continuo con jsQR
                scanIntervalRef.current = setInterval(scanQRCode, 300);
              }
            } catch (error) {
              alert('‚ùå Error con la c√°mara. Usa entrada manual.');
              console.error(error);
            }
          };

          const scanQRCode = () => {
            if (!videoRef.current || !canvasRef.current || !window.jsQR) return;
            
            const video = videoRef.current;
            const canvas = canvasRef.current;
            const context = canvas.getContext('2d');
            
            if (video.readyState !== video.HAVE_ENOUGH_DATA) return;
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            if (canvas.width === 0) return;
            
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
            
            // Escanear con jsQR
            const code = window.jsQR(imageData.data, imageData.width, imageData.height, {
              inversionAttempts: "dontInvert",
            });
            
            if (code && code.data.startsWith('BB_')) {
              const playerId = code.data.replace('BB_', '');
              markAttendance(playerId);
              // No detenemos la c√°mara para poder escanear m√∫ltiples c√≥digos
            }
          };

          const stopCamera = () => {
            if (streamRef.current) {
              streamRef.current.getTracks().forEach(track => track.stop());
              streamRef.current = null;
            }
            if (scanIntervalRef.current) {
              clearInterval(scanIntervalRef.current);
              scanIntervalRef.current = null;
            }
            setScanning(false);
          };

          const getPlayerStats = (playerId) => {
            const attended = sessions.filter(s => s.attendance.includes(playerId)).length;
            const total = sessions.length;
            const percentage = total > 0 ? Math.round((attended / total) * 100) : 0;
            return { attended, total, percentage };
          };

          const downloadQRs = () => {
            if (players.length === 0) {
              alert('‚ùå No hay jugadores');
              return;
            }
            
            players.forEach((player, index) => {
              setTimeout(() => {
                const link = document.createElement('a');
                link.href = generateQR(player.id);
                link.download = `QR_${player.number}_${player.name.replace(/\s/g, '_')}.png`;
                link.click();
              }, index * 500);
            });
            
            alert(`üì• Descargando ${players.length} c√≥digos QR...`);
          };

          const exportData = () => {
            const data = {
              players,
              sessions,
              exportDate: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `basketball_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            alert('‚úì Backup exportado');
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-orange-500 to-red-600 p-4">
              <div className="max-w-4xl mx-auto">
                <div className="bg-white rounded-2xl shadow-2xl overflow-hidden fade-in">
                  
                  {/* Header */}
                  <div className="bg-gradient-to-r from-orange-600 to-red-600 p-6 text-white">
                    <div className="flex justify-between items-start">
                      <div>
                        <h1 className="text-3xl font-bold flex items-center gap-3">
                          üèÄ Basketball Attendance
                        </h1>
                        <p className="text-orange-100 mt-1">Sistema integrado con Google Sheets</p>
                      </div>
                      <div className="text-right">
                        <button 
                          onClick={() => setShowConfig(!showConfig)}
                          className="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition flex items-center gap-2"
                        >
                          {React.createElement(connected ? Wifi : WifiOff, { size: 20 })}
                          {connected ? 'Conectado' : 'Configurar'}
                        </button>
                      </div>
                    </div>
                  </div>

                  {/* Configuraci√≥n */}
                  {showConfig && (
                    <div className="bg-yellow-50 border-b-4 border-yellow-400 p-6">
                      <h3 className="font-bold text-lg mb-3">‚öôÔ∏è Configuraci√≥n Google Sheets</h3>
                      <div className="space-y-3">
                        <div>
                          <label className="block text-sm font-semibold mb-1">Sheet ID:</label>
                          <input
                            type="text"
                            value={config.sheetId}
                            onChange={(e) => setConfig({...config, sheetId: e.target.value})}
                            placeholder="ID de tu Google Sheet"
                            className="w-full p-2 border rounded-lg"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-semibold mb-1">API Key:</label>
                          <input
                            type="text"
                            value={config.apiKey}
                            onChange={(e) => setConfig({...config, apiKey: e.target.value})}
                            placeholder="Tu API Key de Google Cloud"
                            className="w-full p-2 border rounded-lg"
                          />
                        </div>
                        <div className="flex gap-2">
                          <button onClick={saveConfig} className="flex-1 bg-green-600 text-white p-2 rounded-lg hover:bg-green-700">
                            Guardar y Conectar
                          </button>
                          <button onClick={() => loadFromSheets()} className="px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2">
                            {React.createElement(RefreshCw, { size: 16 })}
                            Recargar
                          </button>
                        </div>
                      </div>
                      <p className="text-xs text-gray-600 mt-3">
                        üìñ Crea hojas "Jugadores" (ID, Nombre, N√∫mero, Equipo) y "Sesiones" (ID, Fecha, Asistencia)
                      </p>
                    </div>
                  )}

                  {loading && (
                    <div className="bg-blue-50 p-4 text-center">
                      {React.createElement(RefreshCw, { className: "animate-spin inline-block mr-2" })}
                      Cargando datos desde Google Sheets...
                    </div>
                  )}

                  {/* Menu Principal */}
                  {view === 'menu' && (
                    <div className="p-6">
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <button
                          onClick={() => setView('players')}
                          className="p-6 bg-blue-500 hover:bg-blue-600 text-white rounded-xl flex flex-col items-center gap-3 transition transform hover:scale-105"
                        >
                          {React.createElement(Users, { size: 48 })}
                          <span className="text-xl font-semibold">Gestionar Jugadores</span>
                          <span className="text-sm opacity-90">{players.length} jugadores</span>
                        </button>

                        <button
                          onClick={startSession}
                          className="p-6 bg-green-500 hover:bg-green-600 text-white rounded-xl flex flex-col items-center gap-3 transition transform hover:scale-105"
                        >
                          {React.createElement(Camera, { size: 48 })}
                          <span className="text-xl font-semibold">Tomar Asistencia</span>
                          <span className="text-sm opacity-90">Nueva sesi√≥n</span>
                        </button>

                        <button
                          onClick={() => setView('qrcodes')}
                          className="p-6 bg-purple-500 hover:bg-purple-600 text-white rounded-xl flex flex-col items-center gap-3 transition transform hover:scale-105"
                        >
                          {React.createElement(QrCode, { size: 48 })}
                          <span className="text-xl font-semibold">C√≥digos QR</span>
                          <span className="text-sm opacity-90">Imprimir credenciales</span>
                        </button>

                        <button
                          onClick={() => setView('history')}
                          className="p-6 bg-amber-500 hover:bg-amber-600 text-white rounded-xl flex flex-col items-center gap-3 transition transform hover:scale-105"
                        >
                          {React.createElement(ClipboardList, { size: 48 })}
                          <span className="text-xl font-semibold">Historial</span>
                          <span className="text-sm opacity-90">{sessions.length} sesiones</span>
                        </button>
                      </div>

                      <div className="space-y-3">
                        <button
                          onClick={() => setView('stats')}
                          className="w-full p-4 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg flex items-center justify-center gap-2"
                        >
                          {React.createElement(BarChart3, { size: 20 })}
                          Ver Estad√≠sticas
                        </button>

                        <button onClick={exportData} className="w-full p-3 bg-gray-200 hover:bg-gray-300 rounded-lg flex items-center justify-center gap-2">
                          {React.createElement(Download, { size: 20 })}
                          Exportar Backup Local
                        </button>
                      </div>
                    </div>
                  )}

                  {/* Gesti√≥n de Jugadores */}
                  {view === 'players' && (
                    <div className="p-6">
                      <button onClick={() => setView('menu')} className="mb-4 text-blue-600 hover:underline">
                        ‚Üê Volver
                      </button>

                      <div className="bg-blue-50 p-4 rounded-xl mb-4">
                        <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
                          {React.createElement(Plus, { size: 24 })}
                          Agregar Jugador
                        </h2>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                          <input
                            type="text"
                            placeholder="Nombre completo *"
                            value={newPlayer.name}
                            onChange={(e) => setNewPlayer({...newPlayer, name: e.target.value})}
                            className="p-3 border rounded-lg"
                          />
                          <input
                            type="text"
                            placeholder="N√∫mero *"
                            value={newPlayer.number}
                            onChange={(e) => setNewPlayer({...newPlayer, number: e.target.value})}
                            className="p-3 border rounded-lg"
                          />
                          <input
                            type="text"
                            placeholder="Equipo"
                            value={newPlayer.team}
                            onChange={(e) => setNewPlayer({...newPlayer, team: e.target.value})}
                            className="p-3 border rounded-lg"
                          />
                        </div>
                        <button onClick={addPlayer} className="mt-3 w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700">
                          Agregar Jugador
                        </button>
                      </div>

                      <div className="space-y-2">
                        {players.length === 0 ? (
                          <div className="text-center py-12 text-gray-500">
                            {React.createElement(Users, { size: 64, className: "mx-auto mb-4 opacity-30" })}
                            <p className="text-lg">No hay jugadores</p>
                          </div>
                        ) : (
                          players.map(player => {
                            const stats = getPlayerStats(player.id);
                            return (
                              <div key={player.id} className="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div className="flex-1">
                                  <div className="font-semibold text-lg">#{player.number} - {player.name}</div>
                                  {player.team && <div className="text-sm text-gray-600">{player.team}</div>}
                                  {sessions.length > 0 && (
                                    <div className="text-xs text-gray-500 mt-1">
                                      {stats.attended}/{stats.total} sesiones ({stats.percentage}%)
                                    </div>
                                  )}
                                </div>
                              </div>
                            );
                          })
                        )}
                      </div>
                    </div>
                  )}

                  {/* Esc√°ner */}
                  {view === 'scanner' && (
                    <div className="p-6">
                      <div className="mb-4 flex justify-between items-center">
                        <button 
                          onClick={() => { stopCamera(); setView('menu'); }} 
                          className="text-red-600 hover:underline font-semibold"
                        >
                          ‚úï Cancelar
                        </button>
                        <button 
                          onClick={endSession} 
                          className="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 font-semibold"
                        >
                          Finalizar Sesi√≥n
                        </button>
                      </div>

                      <div className="bg-gradient-to-r from-green-50 to-blue-50 p-4 rounded-xl mb-4 border-2 border-green-200">
                        <div className="text-lg font-semibold mb-2">üìÖ Sesi√≥n Actual</div>
                        <div className="text-3xl font-bold text-green-600 mt-2">
                          {currentSession?.attendance.length || 0} / {players.length}
                        </div>
                      </div>

                      <div className="space-y-3 mb-4">
                        <button 
                          onClick={startCamera} 
                          className="w-full bg-blue-600 text-white p-4 rounded-xl hover:bg-blue-700 flex items-center justify-center gap-2"
                          disabled={scanning}
                        >
                          {React.createElement(Camera, { size: 24 })}
                          {scanning ? 'Escaneando...' : 'Iniciar Esc√°ner QR'}
                        </button>

                        <button 
                          onClick={manualEntry} 
                          className="w-full bg-purple-600 text-white p-4 rounded-xl hover:bg-purple-700"
                        >
                          Entrada Manual (n√∫mero)
                        </button>
                      </div>

                      {scanning && (
                        <div className="relative mb-4">
                          <video ref={videoRef} autoPlay playsInline className="w-full rounded-xl" id="qr-video" />
                          <canvas ref={canvasRef} className="hidden" />
                          <div className="absolute inset-0 border-4 border-green-500 rounded-xl pointer-events-none"></div>
                          <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-48 h-48 border-2 border-white rounded-lg"></div>
                        </div>
                      )}

                      <div className="mt-4">
                        <h3 className="font-semibold mb-2">‚úì Presentes:</h3>
                        <div className="space-y-2">
                          {currentSession?.attendance.length === 0 ? (
                            <p className="text-center py-8 text-gray-500">Sin registros a√∫n</p>
                          ) : (
                            currentSession?.attendance.map(id => {
                              const player = players.find(p => p.id === id);
                              return player && (
                                <div key={id} className="p-3 bg-green-50 rounded-lg border-l-4 border-green-500">
                                  <div className="font-semibold">#{player.number} - {player.name}</div>
                                </div>
                              );
                            })
                          )}
                        </div>
                      </div>
                    </div>
                  )}

                  {/* QR Codes */}
                  {view === 'qrcodes' && (
                    <div className="p-6">
                      <button onClick={() => setView('menu')} className="mb-4 text-blue-600 hover:underline">
                        ‚Üê Volver
                      </button>

                      {players.length > 0 && (
                        <button 
                          onClick={downloadQRs} 
                          className="w-full mb-4 bg-purple-600 text-white p-3 rounded-lg hover:bg-purple-700 flex items-center justify-center gap-2"
                        >
                          {React.createElement(Download, { size: 20 })}
                          Descargar Todos ({players.length})
                        </button>
                      )}

                      {players.length === 0 ? (
                        <div className="text-center py-12 text-gray-500">
                          {React.createElement(QrCode, { size: 64, className: "mx-auto mb-4 opacity-30" })}
                          <p>No hay jugadores</p>
                        </div>
                      ) : (
                        <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                          {players.map(player => (
                            <div key={player.id} className="border-2 rounded-xl p-4 text-center bg-white">
                              <img src={generateQR(player.id)} alt={player.name} className="w-full rounded-lg mb-2" />
                              <div className="font-bold">#{player.number}</div>
                              <div className="text-sm">{player.name}</div>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                  )}

                  {/* Historial */}
                  {view === 'history' && (
                    <div className="p-6">
                      <button onClick={() => setView('menu')} className="mb-4 text-blue-600 hover:underline">
                        ‚Üê Volver
                      </button>

                      {sessions.length === 0 ? (
                        <div className="text-center py-12 text-gray-500">
                          {React.createElement(ClipboardList, { size: 64, className: "mx-auto mb-4 opacity-30" })}
                          <p>No hay sesiones registradas</p>
                        </div>
                      ) : (
                        <div className="space-y-3">
                          {sessions.slice().reverse().map(session => (
                            <div key={session.id} className="border-2 rounded-xl p-4 bg-gray-50">
                              <div className="flex justify-between mb-2">
                                <div className="font-bold">
                                  {new Date(session.date).toLocaleDateString('es')}
                                </div>
                                <div className="text-green-600 font-bold">{session.attendance.length}</div>
                              </div>
                              <div className="flex flex-wrap gap-2">
                                {session.attendance.map(id => {
                                  const player = players.find(p => p.id === id);
                                  return player && (
                                    <span key={id} className="bg-green-100 px-2 py-1 rounded text-sm">
                                      #{player.number}
                                    </span>
                                  );
                                })}
                              </div>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                  )}

                  {/* Estad√≠sticas */}
                  {view === 'stats' && (
                    <div className="p-6">
                      <button onClick={() => setView('menu')} className="mb-4 text-blue-600 hover:underline">
                        ‚Üê Volver
                      </button>

                      <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
                        {React.createElement(BarChart3, { size: 28 })}
                        Estad√≠sticas
                      </h2>

                      {sessions.length === 0 ? (
                        <div className="text-center py-12 text-gray-500">
                          <p>No hay datos suficientes</p>
                        </div>
                      ) : (
                        <div className="space-y-4">
                          {players.map(player => {
                            const stats = getPlayerStats(player.id);
                            return (
                              <div key={player.id} className="border rounded-xl p-4 bg-gray-50">
                                <div className="flex justify-between mb-2">
                                  <div>
                                    <div className="font-bold">#{player.number} - {player.name}</div>
                                  </div>
                                  <div className="text-right">
                                    <div className="text-2xl font-bold text-blue-600">{stats.percentage}%</div>
                                    <div className="text-xs">{stats.attended}/{stats.total}</div>
                                  </div>
                                </div>
                                <div className="w-full bg-gray-200 rounded-full h-3">
                                  <div 
                                    className="bg-blue-600 h-3 rounded-full"
                                    style={{width: `${stats.percentage}%`}}
                                  />
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      )}
                    </div>
                  )}

                </div>
              </div>
            </div>
          );
        };

        // Renderizar la aplicaci√≥n
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(BasketballAttendance));
    </script>
</body>
</html>
